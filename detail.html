<!doctype html>
<html lang="en" class="is-signal">

<head>
    <title>Prannay</title>

    <meta charset="utf-8">
    <meta content="ie=edge" http-equiv="x-ua-compatible">
    <meta name="handheldfriendly" content="true">
    <meta name="viewport" content="initial-scale=1, width=device-width">
    <meta name="description" content="Content page">
    <meta name="theme-color" content="#000000">

    <link rel="canonical" href="detail.html">
    <link rel="icon" href="assets/images/favicon.jpeg">
    <link rel="mask-icon" href="assets/images/mask-icon.svg" color="#000000">
    <link rel="apple-touch-icon" href="assets/images/apple-touch-icon.png">

    <!-- Keep all existing CSS -->
    <link rel="stylesheet" type="text/css" href="assets/css/reset.css">
    <link rel="stylesheet" type="text/css" href="assets/css/root.css">
    <link rel="stylesheet" type="text/css" href="assets/css/fonts.css">
    <link rel="stylesheet" type="text/css" href="assets/css/elements.css">
    <link rel="stylesheet" type="text/css" href="assets/css/button.css">
    <link rel="stylesheet" type="text/css" href="assets/css/content.css">
    <link rel="stylesheet" type="text/css" href="assets/css/books.css">
    <link rel="stylesheet" type="text/css" href="assets/css/boundary.css">
    <link rel="stylesheet" type="text/css" href="assets/css/cluster.css">
    <link rel="stylesheet" type="text/css" href="assets/css/controller.css">
    <link rel="stylesheet" type="text/css" href="assets/css/footer.css">
    <link rel="stylesheet" type="text/css" href="assets/css/header.css">
    <link rel="stylesheet" type="text/css" href="assets/css/jobs.css">
    <link rel="stylesheet" type="text/css" href="assets/css/nav.css">
    <link rel="stylesheet" type="text/css" href="assets/css/origin.css">
    <link rel="stylesheet" type="text/css" href="assets/css/page.css">
    <link rel="stylesheet" type="text/css" href="assets/css/policies.css">
    <link rel="stylesheet" type="text/css" href="assets/css/signal.css">
    <link rel="stylesheet" type="text/css" href="assets/css/signup.css">
    <link rel="stylesheet" type="text/css" href="assets/css/thought.css">
    <link rel="stylesheet" type="text/css" href="assets/css/thoughts.css">
    <link rel="stylesheet" type="text/css" href="assets/css/print.css" media="print">

    <!-- Blog-specific styles -->
    <link rel="stylesheet" type="text/css" href="assets/css/blog-detail.css">

    <!-- Markdown parser -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- Syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <!-- KaTeX for math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <script defer src="assets/js/script.js" type="module"></script>

</head>

<body>

    <input class="nav-active" id="nav-active" type="checkbox">
    <label class="nav-underlay" for="nav-active"></label>

    <nav class="nav">
        <div class="nav__logo">
            <a href="index.html" aria-label="Home"><img src="assets/images/logo-black.svg" alt="Prannay Hebbar"></a>
        </div>

        <div class="nav__toggle">
            <label for="nav-active">
                <span>Menu</span>
            </label>
        </div>

        <div class="nav__options">
            <ul>
                <li><a href="index.html" aria-label="TLDR">TLDR</a></li>
                <li><a href="blogs.html" aria-label="Blogs">Blogs</a></li>
                <li><a href="principles.html" aria-label="Principles">Principles</a></li>
                <li><a href="other-stuff.html" aria-label="Other Stuff">Other Stuff</a></li>
                <li><a href="contact.html" aria-label="Contact">Contact</a></li>
            </ul>

            <ul>
                <li><a href="https://x.com/Pran_Ker" target="_blank" rel="noopener" aria-label="Twitter">Twitter</a></li>
                <li><a href="https://github.com/Pran-Ker" target="_blank" rel="noopener" aria-label="GitHub">GitHub</a></li>
                <li><a href="https://www.linkedin.com/in/prannay/" target="_blank" rel="noopener" aria-label="LinkedIn">LinkedIn</a></li>
            </ul>
        </div>
    </nav>

    <header class="header">
        <h1><a href="index.html" aria-label="Prannay Hebbar"><img src="assets/images/logo.svg" alt="Prannay Hebbar"></a></h1>

        <ul>
            <li><a href="index.html" aria-label="TLDR">TLDR</a></li>
            <li><a href="blogs.html" aria-label="Blogs">Blogs</a></li>
            <li><a href="principles.html" aria-label="Principles">Principles</a></li>
            <li><a href="other-stuff.html" aria-label="Other Stuff">Other Stuff</a></li>
            <li><a href="contact.html" aria-label="Contact">Contact</a></li>
        </ul>
    </header>

    <main class="blog-post-main">
        
        <!-- Blog post heading -->
        <div class="blog-post-heading">
            <h1 class="blog-post-title" id="blog-title">Loading...</h1>
            <div class="blog-post-metadata" id="blog-metadata">
                <!-- Reading time will be inserted here -->
            </div>
        </div>

        <!-- Back button -->
        <div class="back-button-container">
            <button onclick="history.back()" class="button button--ghost">
                ← Back
            </button>
        </div>

        <!-- Left-side Table of Contents -->
        <nav class="left-toc" id="left-toc">
            <div class="toc-title">Contents</div>
            <ul class="toc-list" id="toc-list">
                <!-- TOC will be generated here -->
            </ul>
        </nav>

        <!-- Article content -->
        <article class="blog-article-content" id="content">
            <!-- Content will be loaded here -->
            <p>Loading...</p>
        </article>

        <!-- Navigation between posts -->
        <nav class="article-navigation" id="article-nav" style="display: none;">
            <!-- Prev/Next links will be inserted here -->
        </nav>
    </main>

    <div class="boundary"></div>

    <footer class="footer">
        <ul>
            <li><a href="https://www.linkedin.com/in/prannay/" target="_blank" rel="noopener" aria-label="LinkedIn">LinkedIn</a></li>
            <li><a href="https://github.com/Pran-Ker" target="_blank" rel="noopener" aria-label="GitHub">GitHub</a></li>
            <li><a href="https://x.com/Pran_Ker" target="_blank" rel="noopener" aria-label="Twitter">Twitter</a></li>
            <li><a href="https://www.instagram.com/prannay.hebbar/" target="_blank" rel="noopener" aria-label="Instagram">Instagram</a></li>
        </ul>
    </footer>

    <script>
        // Calculate reading time
        function calculateReadingTime(text) {
            const wordsPerMinute = 200;
            const words = text.trim().split(/\s+/).length;
            const minutes = Math.ceil(words / wordsPerMinute);
            return minutes;
        }

        // Generate table of contents
        function generateTableOfContents() {
            const contentDiv = document.getElementById('content');
            const headings = contentDiv.querySelectorAll('h2, h3');

            if (headings.length === 0) {
                return;
            }

            const tocList = document.getElementById('toc-list');
            tocList.innerHTML = '';

            headings.forEach((heading, index) => {
                // Add ID to heading for anchor links
                const id = `section-${index}`;
                heading.id = id;

                // Create TOC item
                const li = document.createElement('li');
                li.className = 'toc-item';

                if (heading.tagName === 'H3') {
                    li.classList.add('toc-level-3');
                }

                const a = document.createElement('a');
                a.href = `#${id}`;
                a.textContent = heading.textContent;

                li.appendChild(a);
                tocList.appendChild(li);
            });
        }

        // Add copy button to code blocks
        function addCopyButtons() {
            const codeBlocks = document.querySelectorAll('.blog-article-content pre');

            codeBlocks.forEach((pre) => {
                // Wrap pre in a div for positioning
                const wrapper = document.createElement('div');
                wrapper.className = 'code-block-wrapper';
                pre.parentNode.insertBefore(wrapper, pre);
                wrapper.appendChild(pre);

                // Create copy button
                const button = document.createElement('button');
                button.className = 'copy-button';
                button.innerHTML = 'Copy';
                button.setAttribute('aria-label', 'Copy code to clipboard');

                button.addEventListener('click', async () => {
                    const code = pre.querySelector('code');
                    const text = code.textContent;

                    try {
                        await navigator.clipboard.writeText(text);
                        button.innerHTML = 'Copied!';
                        button.classList.add('copied');

                        setTimeout(() => {
                            button.innerHTML = 'Copy';
                            button.classList.remove('copied');
                        }, 2000);
                    } catch (err) {
                        console.error('Failed to copy:', err);
                    }
                });

                wrapper.appendChild(button);
            });
        }

        // Add language labels to code blocks
        function addLanguageLabels() {
            const codeBlocks = document.querySelectorAll('.blog-article-content pre code');

            codeBlocks.forEach((code) => {
                // Check if highlight.js detected a language
                const classes = code.className.split(' ');
                const langClass = classes.find(c => c.startsWith('language-'));

                if (langClass) {
                    const lang = langClass.replace('language-', '');
                    code.setAttribute('data-lang', lang);
                }
            });
        }

        // Add prev/next navigation
        async function addPrevNextNav(currentSlug) {
            try {
                const response = await fetch('content/blog-posts.json');
                const posts = await response.json();

                const currentIndex = posts.findIndex(post => currentSlug.includes(post.slug));

                if (currentIndex === -1) return;

                const prevPost = posts[currentIndex - 1];
                const nextPost = posts[currentIndex + 1];

                if (!prevPost && !nextPost) return;

                const navDiv = document.getElementById('article-nav');
                let navHtml = '<div style="display: flex; justify-content: space-between; align-items: center; gap: 2em;">';

                if (prevPost) {
                    navHtml += `
                        <a href="detail.html#${prevPost.slug}" class="nav-prev">
                            <div class="nav-label">← Previous</div>
                            <div class="nav-title">${prevPost.title}</div>
                        </a>
                    `;
                } else {
                    navHtml += '<div style="flex: 1;"></div>';
                }

                if (nextPost) {
                    navHtml += `
                        <a href="detail.html#${nextPost.slug}" class="nav-next">
                            <div class="nav-label">Next →</div>
                            <div class="nav-title">${nextPost.title}</div>
                        </a>
                    `;
                } else {
                    navHtml += '<div style="flex: 1;"></div>';
                }

                navDiv.innerHTML = navHtml;
                navDiv.style.display = 'flex';
            } catch (error) {
                console.error('Error loading blog navigation:', error);
            }
        }

        // Load markdown content based on URL hash
        async function loadContent() {
            const contentDiv = document.getElementById('content');
            const hash = window.location.hash.substring(1);

            if (!hash) {
                contentDiv.innerHTML = '<p>No content specified.</p>';
                return;
            }

            try {
                // Try HTML first, then fallback to markdown
                let response = await fetch(`content/${hash}.html`);
                let isHtml = false;

                if (response.ok) {
                    isHtml = true;
                } else {
                    // Fallback to markdown
                    response = await fetch(`content/${hash}.md`);
                    if (!response.ok) {
                        throw new Error('Content not found');
                    }
                }

                const content = await response.text();

                if (isHtml) {
                    // For HTML files, extract body content and inject directly
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(content, 'text/html');
                    contentDiv.innerHTML = doc.body.innerHTML;
                } else {
                    // For markdown files, parse as usual
                    const html = marked.parse(content);
                    contentDiv.innerHTML = html;
                }

                // Update page title and blog title
                const firstHeading = contentDiv.querySelector('h1');
                if (firstHeading) {
                    document.title = `Prannay — ${firstHeading.textContent}`;
                    document.getElementById('blog-title').textContent = firstHeading.textContent;
                    // Remove h1 from content since it's now in the header
                    firstHeading.remove();
                } else {
                    document.title = 'Prannay';
                }

                // Apply syntax highlighting
                contentDiv.querySelectorAll('pre code').forEach((block) => {
                    hljs.highlightElement(block);
                });

                // Add language labels to code blocks
                addLanguageLabels();

                // Add copy buttons to code blocks
                addCopyButtons();

                // Render math equations with KaTeX
                if (window.renderMathInElement) {
                    renderMathInElement(contentDiv, {
                        delimiters: [
                            {left: '$$', right: '$$', display: true},
                            {left: '$', right: '$', display: false},
                            {left: '\\[', right: '\\]', display: true},
                            {left: '\\(', right: '\\)', display: false}
                        ],
                        throwOnError: false
                    });
                }

                // Calculate and display reading time
                const readingTime = calculateReadingTime(contentDiv.textContent);
                const metaDiv = document.getElementById('blog-metadata');
                metaDiv.innerHTML = `<span>${readingTime} min read</span>`;

                // Generate table of contents
                generateTableOfContents();

                // Add prev/next navigation
                addPrevNextNav(hash);

            } catch (error) {
                contentDiv.innerHTML = `<p>Error loading content: ${error.message}</p>`;
            }
        }

        // Wait for KaTeX to load before processing content
        function init() {
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', loadContent);
            } else {
                loadContent();
            }
        }

        // Load content on page load and hash change
        init();
        window.addEventListener('hashchange', loadContent);
    </script>

</body>
</html>